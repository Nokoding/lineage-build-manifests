name: LineageOS 16.0 Build - gts210vewifi

# This allows you to manually trigger the workflow from the GitHub Actions tab.
on:
  workflow_dispatch:

jobs:
  build:
    # Specifies the runner to use the Ubuntu 20.04 LTS image.
    runs-on: ubuntu-20.04
    
    steps:
    - name: Checkout manifest repository
      uses: actions/checkout@v4
      with:
        # IMPORTANT: Replace <YOUR_GITHUB_USERNAME> with your username
        repository: Nokoding/lineage-build-manifests
        
    - name: Install build dependencies
      run: |
        sudo apt update
        # Installs all necessary LineageOS build tools, including make and ImageMagick.
        sudo apt install -y bc bison build-essential ccache curl flex g++-multilib imagemagick git gnupg gperf lib32ncurses5-dev lib32readline-dev lib32z1-dev libesd0-dev liblz4-tool libncurses5-dev libsdl1.2-dev libssl-dev libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc zip zlib1g-dev
        
    - name: Initialize Repo and Sync Source
      run: |
        # Initialize the repository tool for the lineage-16.0 branch
        repo init --depth=1 -u https://github.com/LineageOS/android.git -b lineage-16.0
        
        # Copy your local_manifests.xml from this repository into the build environment
        mkdir -p .repo/local_manifests
        cp local_manifests.xml .repo/local_manifests/
        
        # Sync the entire source tree using all available cores on the runner
        repo sync -c -j$(nproc) --force-sync --no-tags --no-clone-bundle

    - name: Start the Build
      run: |
        # Load the build environment functions (breakfast, brunch)
        source build/envsetup.sh
        
        # Start the compilation process
        brunch gts210vewifi

    - name: Upload Final Artifact (ZIP)
      uses: actions/upload-artifact@v4
      with:
        name: lineage-16.0-gts210vewifi
        # Path where the final flashable ZIP file is created
        path: out/target/product/gts210vewifi/lineage-*.zip
